<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mapa de Esquemas ‚Äì Invent√°rio de Padr√µes Emocionais</title>

    <meta name="description" content="Mapa de Esquemas ‚Äì Invent√°rio de Padr√µes Emocionais baseado na Terapia do Esquema para apoio √† psicoterapia.">
    <meta name="keywords" content="Terapia do Esquema, Esquemas Iniciais Desadaptativos, rastreio, psicologia, avalia√ß√£o psicol√≥gica, autoconhecimento">
    <meta name="author" content="Richelmy Murta‚à¥, Psic√≥logo Cl√≠nico">

    <!-- Open Graph -->
    <meta property="og:title" content="Mapa de Esquemas ‚Äì Invent√°rio de Padr√µes Emocionais">
    <meta property="og:description" content="Ferramenta de autoconhecimento baseada na Terapia do Esquema para apoiar sua psicoterapia.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://i.pinimg.com/736x/1f/68/67/1f6867294fd6c1b101f2fdab626e658b.jpg">
    <meta property="og:url" content="https://https://ricmurtapsicologia.github.io/rastreio.de.esquemas/">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Mapa de Esquemas ‚Äì Invent√°rio de Padr√µes Emocionais">
    <meta name="twitter:description" content="Ferramenta de autoconhecimento baseada na Terapia do Esquema.">
    <meta name="twitter:image" content="https://i.pinimg.com/736x/1f/68/67/1f6867294fd6c1b101f2fdab626e658b.jpg">

    <link rel="icon" type="image/jpeg" href="https://i.pinimg.com/736x/1f/68/67/1f6867294fd6c1b101f2fdab626e658b.jpg">

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-light: #f5f5f7;
            --bg-card-light: #ffffff;
            --text-light: #222222;
            --accent-light: #0066cc;
            --accent-soft-light: #e0f0ff;

            --bg-dark: #101119;
            --bg-card-dark: #171922;
            --text-dark: #f5f5f7;
            --accent-dark: #4da3ff;
            --accent-soft-dark: #1f2a3a;

            --radius-lg: 18px;
            --radius-md: 10px;
            --shadow-soft: 0 10px 30px rgba(0, 0, 0, 0.12);
            --transition-fast: 0.2s ease;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            max-width: 100%;
            overflow-x: hidden;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        body {
            line-height: 1.6;
            background-color: var(--bg-light);
            color: var(--text-light);
            transition: background-color var(--transition-fast), color var(--transition-fast);
        }

        body.theme-dark {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 16px;
        }

        header {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 12px;
        }

        .theme-toggle {
            border-radius: 999px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            padding: 6px 14px;
            background: var(--bg-card-light);
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: var(--shadow-soft);
            transition: transform var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast);
            color: var(--text-light);
        }

        body.theme-dark .theme-toggle {
            background: var(--bg-card-dark);
            border-color: rgba(255, 255, 255, 0.25);
            color: var(--text-dark);
        }

        .theme-toggle:hover {
            transform: translateY(-1px);
            box-shadow: 0 14px 40px rgba(0, 0, 0, 0.25);
        }

        /* HERO / CAPA */
        .hero {
            display: grid;
            grid-template-columns: minmax(0, 2.2fr) minmax(0, 1.4fr);
            gap: 0;
            align-items: stretch;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 45%, #020617 100%);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            margin-bottom: 22px;
            overflow: hidden;
            position: relative;
        }

        body.theme-dark .hero {
            background: linear-gradient(135deg, #020617 0%, #020617 40%, #0f172a 100%);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.7);
        }

        .hero::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.35), transparent 55%);
            opacity: 0.9;
            pointer-events: none;
        }

        .hero-text {
            position: relative;
            padding: 20px 22px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: left;
            color: #e5e7eb;
        }

        .hero-kicker {
            font-size: 0.78rem;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            opacity: 0.9;
            margin-bottom: 6px;
        }

        .hero-title {
            margin: 0;
            font-size: 1.8rem;
            letter-spacing: 0.03em;
            line-height: 1.35;
        }

        .hero-subtitle {
            margin-top: 8px;
            font-size: 0.95rem;
            opacity: 0.95;
            max-width: 480px;
            text-align: justify;
        }

        .hero-meta {
            margin-top: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            font-size: 0.78rem;
            opacity: 0.9;
        }

        .hero-pill {
            border-radius: 999px;
            padding: 4px 10px;
            border: 1px solid rgba(148, 163, 184, 0.5);
            background: rgba(15, 23, 42, 0.7);
        }

        .hero-img-wrapper {
            position: relative;
            min-height: 180px;
            overflow: hidden;
        }

        .hero-img-wrapper::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.3), rgba(15, 23, 42, 0.7));
            mix-blend-mode: multiply;
            pointer-events: none;
        }

        .hero-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transform: scale(1.04);
        }

        @media (max-width: 720px) {
            .hero {
                grid-template-columns: 1fr;
            }

            .hero-img-wrapper {
                max-height: 220px;
            }
        }

        .card {
            background-color: var(--bg-card-light);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 16px 18px 18px 18px;
            margin-bottom: 18px;
            transition: background-color var(--transition-fast), box-shadow var(--transition-fast);
        }

        body.theme-dark .card {
            background-color: var(--bg-card-dark);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.7);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .card-title {
            font-size: 1.05rem;
            font-weight: 600;
            letter-spacing: 0.02em;
        }

        .card-tag {
            font-size: 0.75rem;
            padding: 3px 10px;
            border-radius: 999px;
            background-color: var(--accent-soft-light);
            color: var(--accent-light);
        }

        body.theme-dark .card-tag {
            background-color: var(--accent-soft-dark);
            color: var(--accent-dark);
        }

        .card p {
            margin-top: 4px;
            margin-bottom: 6px;
        }

        .muted {
            font-size: 0.9rem;
            opacity: 0.95;
            text-align: justify;
            line-height: 1.7;
        }

        .btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .btn {
            border-radius: 999px;
            border: none;
            cursor: pointer;
            padding: 8px 16px;
            font-size: 0.88rem;
            font-weight: 500;
            transition: background-color var(--transition-fast), color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
        }

        .btn-primary {
            background-color: var(--accent-light);
            color: #ffffff;
            box-shadow: 0 10px 25px rgba(0, 102, 204, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 14px 36px rgba(0, 102, 204, 0.4);
        }

        body.theme-dark .btn-primary {
            background-color: var(--accent-dark);
            box-shadow: 0 10px 25px rgba(77, 163, 255, 0.35);
        }

        .btn-secondary {
            background-color: transparent;
            border: 1px solid rgba(0, 0, 0, 0.15);
            color: inherit;
        }

        body.theme-dark .btn-secondary {
            border-color: rgba(255, 255, 255, 0.25);
        }

        .btn-ghost {
            background: transparent;
            border: none;
            color: inherit;
            opacity: 0.85;
        }

        .btn-ghost:hover {
            opacity: 1;
        }

        .hidden {
            display: none;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 4px;
            letter-spacing: 0.02em;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 8px;
        }

        .field {
            flex: 1 1 220px;
            min-width: 160px;
        }

        label {
            display: block;
            font-size: 0.8rem;
            margin-bottom: 2px;
            opacity: 0.9;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        select {
            width: 100%;
            padding: 6px 8px;
            border-radius: var(--radius-md);
            border: 1px solid rgba(0, 0, 0, 0.18);
            background: transparent;
            color: inherit;
            font-size: 0.9rem;
        }

        body.theme-dark input,
        body.theme-dark select {
            border-color: rgba(255, 255, 255, 0.18);
        }

        .helper {
            font-size: 0.8rem;
            opacity: 0.86;
            margin-top: 6px;
            text-align: justify;
            line-height: 1.6;
        }

        .progress-wrapper {
            margin-top: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            border-radius: 999px;
            background-color: rgba(0, 0, 0, 0.06);
            overflow: hidden;
        }

        .progress-inner {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--accent-light), #00b894);
            transition: width 0.25s ease;
        }

        body.theme-dark .progress-bar {
            background-color: rgba(255, 255, 255, 0.08);
        }

        .question-block {
            border-radius: var(--radius-md);
            padding: 10px 12px;
            margin-top: 10px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            background: rgba(248, 250, 252, 0.8);
        }

        body.theme-dark .question-block {
            border-color: rgba(255, 255, 255, 0.12);
            background: rgba(15, 23, 42, 0.8);
        }

        .question-block.missing {
            border-color: rgba(220, 38, 38, 0.85);
        }

        body.theme-dark .question-block.missing {
            border-color: rgba(248, 113, 113, 0.85);
        }

        .error-msg {
            font-size: 0.75rem;
            margin-top: 4px;
            color: #b91c1c;
        }

        body.theme-dark .error-msg {
            color: #fecaca;
        }

        .question-header {
            margin-bottom: 6px;
        }

        .question-text {
            font-size: 0.9rem;
            text-align: justify;
        }

        .likert-row {
            display: flex;
            justify-content: space-between;
            gap: 4px;
            margin-top: 6px;
            font-size: 0.78rem;
        }

        .likert-option {
            flex: 1;
            text-align: center;
        }

        .likert-option input {
            margin-bottom: 2px;
        }

        .status-chip {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 0.72rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .status-ativo {
            background-color: rgba(220, 38, 38, 0.12);
            color: #b91c1c;
        }

        .status-latente {
            background-color: rgba(234, 179, 8, 0.12);
            color: #92400e;
        }

        .status-ausente {
            background-color: rgba(22, 163, 74, 0.12);
            color: #166534;
        }

        body.theme-dark .status-ativo {
            background-color: rgba(248, 113, 113, 0.25);
            color: #fecaca;
        }

        body.theme-dark .status-latente {
            background-color: rgba(253, 224, 71, 0.25);
            color: #fef9c3;
        }

        body.theme-dark .status-ausente {
            background-color: rgba(74, 222, 128, 0.25);
            color: #bbf7d0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
            font-size: 0.85rem;
        }

        th,
        td {
            text-align: left;
            padding: 6px 4px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        body.theme-dark th,
        body.theme-dark td {
            border-color: rgba(255, 255, 255, 0.1);
        }

        th {
            font-weight: 600;
            font-size: 0.78rem;
            opacity: 0.9;
        }

        .tooltip {
            border-bottom: 1px dotted currentColor;
            cursor: help;
            font-size: 0.8rem;
            opacity: 0.9;
        }

        /* Wrapper responsivo para tabela de resultados */
        #resultsTableWrapper {
            width: 100%;
            overflow-x: auto;
        }

        #resultsTableWrapper table {
            min-width: 640px;
        }

        /* MODAL */
        .modal {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.hidden {
            display: none;
        }

        .modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.45);
        }

        .modal-card {
            position: relative;
            max-width: 520px;
            width: calc(100% - 32px);
            background: var(--bg-card-light);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 18px 20px 16px 20px;
            z-index: 1001;
        }

        body.theme-dark .modal-card {
            background: var(--bg-card-dark);
        }

        .modal-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .modal-close {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            opacity: 0.8;
        }

        .modal-close:hover {
            opacity: 1;
        }

        footer {
            margin: 24px 0 30px 0;
            font-size: 0.78rem;
            text-align: center;
            opacity: 0.9;
            letter-spacing: 0.04em;
            line-height: 1.5;
        }

        footer strong {
            font-weight: 600;
        }

        .footer-note {
            font-size: 0.7rem;
            font-style: italic;
        }

        @media (max-width: 600px) {
            header {
                justify-content: flex-end;
            }

            /* empilhar campos no mobile para evitar corte/sobreposi√ß√£o */
            .form-row {
                flex-direction: column;
                flex-wrap: nowrap;
                gap: 8px;
            }

            .field {
                flex: 1 1 auto;
                min-width: 0;
            }
        }

        /* Cards 3D para "Entendendo seus esquemas ativos" */
        .schema-card {
            margin-bottom: 24px;
            padding: 12px 14px;
            border-radius: var(--radius-md);
            background: linear-gradient(145deg, #f9fafb, #e5e7eb);
            box-shadow: 0 6px 16px rgba(15, 23, 42, 0.12);
            line-height: 1.7;
        }

        body.theme-dark .schema-card {
            background: linear-gradient(145deg, #020617, #0f172a);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7);
        }

        .schema-card p {
            margin-bottom: 6px;
        }

        .schema-card p:first-child strong {
            color: #b91c1c;
        }

        body.theme-dark .schema-card p:first-child strong {
            color: #fecaca;
        }

        /* Bot√µes finais centralizados e bot√£o WhatsApp */
        #actionsSection .btn-row {
            justify-content: center;
        }

        .btn-whatsapp {
            background-color: #25d366;
            color: #ffffff;
            border: none;
            box-shadow: 0 10px 25px rgba(37, 211, 102, 0.35);
        }

        .btn-whatsapp:hover {
            transform: translateY(-1px);
            box-shadow: 0 14px 36px rgba(37, 211, 102, 0.45);
        }

        body.theme-dark .btn-whatsapp {
            background-color: #25d366;
            box-shadow: 0 10px 25px rgba(37, 211, 102, 0.45);
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <button class="theme-toggle" id="themeToggle">
                <span>üåó</span><span>Tema claro/escuro</span>
            </button>
        </header>

        <section class="hero">
            <div class="hero-text">
                <div class="hero-kicker">Rastreio Cl√≠nico ¬∑ Terapia do Esquema</div>
                <h1 class="hero-title">Mapa de Esquemas ‚Äì Invent√°rio de Padr√µes Emocionais</h1>
                <p class="hero-subtitle">
                    Uma ferramenta cl√≠nica de apoio √† psicoterapia, organizada para mapear Esquemas Iniciais Desadaptativos,
                    estilos de enfrentamento e dom√≠nios emocionais que se repetem na sua hist√≥ria.
                </p>
                <div class="hero-meta">
                    <span class="hero-pill">Aplica√ß√£o individual guiada</span>
                    <span class="hero-pill">Resultados para reflex√£o em terapia</span>
                    <span class="hero-pill">Baseado em Terapia do Esquema</span>
                </div>
            </div>
            <div class="hero-img-wrapper">
                <img class="hero-img" src="https://i.pinimg.com/736x/1f/68/67/1f6867294fd6c1b101f2fdab626e658b.jpg" alt="Imagem abstrata relacionada a emo√ß√µes e terapia.">
            </div>
        </section>

        <!-- INTRO -->
        <section id="introSection" class="card">
            <div class="card-header">
                <div class="card-title">Bem-vindo(a)</div>
                <span class="card-tag">Passo 1 de 4</span>
            </div>
            <p class="muted">
                Aqui voc√™ encontrar√° afirma√ß√µes que descrevem maneiras de sentir, pensar e se relacionar. Elas foram organizadas
                para ajudar a identificar <strong>Esquemas Iniciais Desadaptativos (EIDs)</strong> ‚Äì padr√µes emocionais e cognitivos profundos que
                influenciam sua vida e costumam se repetir em diferentes contextos.
            </p>
            <p class="muted">
                Esta ferramenta √© um <strong>rastreio cl√≠nico</strong> de autoconhecimento. Ela n√£o substitui avalia√ß√£o psicol√≥gica, psiqui√°trica
                ou acompanhamento em psicoterapia. Em caso de sofrimento intenso ou pensamentos de morte/suic√≠dio, procure ajuda
                imediata em servi√ßos de sa√∫de ou ligue para servi√ßos de apoio emocional da sua regi√£o.
            </p>
            <div class="btn-row">
                <button class="btn btn-primary" id="goConsent">Continuar</button>
                <button class="btn btn-ghost" id="learnEidsBtn" type="button">
                    Saiba mais sobre EIDs
                </button>
            </div>
        </section>

        <!-- MODAL SAIBA MAIS -->
        <div id="eidsModal" class="modal hidden" aria-hidden="true">
            <div class="modal-backdrop"></div>
            <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="eidsModalTitle">
                <div class="modal-card-header">
                    <div class="card-title" id="eidsModalTitle">O que s√£o EIDs?</div>
                    <button class="modal-close" id="closeEidsModal" aria-label="Fechar">‚úï</button>
                </div>
                <p class="muted">
                    <strong>Esquemas Iniciais Desadaptativos</strong> s√£o padr√µes emocionais e de pensamento muito antigos, normalmente formados
                    na inf√¢ncia ou adolesc√™ncia, que continuam influenciando como voc√™ se enxerga, se relaciona e reage √†s situa√ß√µes.
                </p>
                <p class="muted">
                    Eles n√£o s√£o ‚Äúdefeitos de car√°ter‚Äù, mas formas de interpretar o mundo que fizeram sentido em algum momento
                    da hist√≥ria de vida e, hoje, podem gerar sofrimento, conflitos ou repeti√ß√£o de padr√µes.
                </p>
                <p class="muted">
                    Identificar seus esquemas √© um primeiro passo para, junto com seu psic√≥logo(a), construir maneiras mais
                    cuidadosas e equilibradas de se proteger, se relacionar e se posicionar.
                </p>
                <div class="btn-row" style="justify-content:flex-end;margin-top:10px;">
                    <button class="btn btn-secondary" id="closeEidsModal2">Entendi</button>
                </div>
            </div>
        </div>

        <!-- CONSENTIMENTO -->
        <section id="consentSection" class="card hidden">
            <div class="card-header">
                <div class="card-title">Consentimento informado</div>
                <span class="card-tag">Passo 2 de 4</span>
            </div>
            <p class="muted">
                Ao prosseguir, voc√™ concorda em utilizar esta ferramenta apenas para fins de autoconhecimento e entende que:
            </p>
            <ul class="muted" style="padding-left:18px;margin-top:4px;">
                <li>os resultados s√£o indicativos, n√£o um diagn√≥stico;</li>
                <li>as informa√ß√µes podem ser √∫teis para conversa em psicoterapia;</li>
                <li>voc√™ √© respons√°vel por decidir se compartilha ou n√£o seus resultados.</li>
            </ul>
            <p class="muted">
                Se voc√™ estiver em sofrimento emocional grave, entre em contato com servi√ßos de sa√∫de de sua regi√£o e utilize
                o resultado apenas como apoio √† conversa com seu psic√≥logo(a)/psiquiatra.
            </p>
            <div class="btn-row">
                <button class="btn btn-primary" id="acceptConsent">Aceito e desejo continuar</button>
                <button class="btn btn-secondary" id="backToIntro">Voltar</button>
            </div>
        </section>

        <!-- DADOS B√ÅSICOS -->
        <section id="userdataSection" class="card hidden">
            <div class="card-header">
                <div class="card-title">Seus dados b√°sicos</div>
                <span class="card-tag">Passo 3 de 4</span>
            </div>
            <p class="muted">
                Estes campos servem apenas para identifica√ß√£o nos seus registros e, se desejar, na mensagem ao seu psic√≥logo(a) via WhatsApp.
                As informa√ß√µes ficam no seu dispositivo e s√≥ ser√£o compartilhadas se voc√™ decidir enviar o resumo.
            </p>
            <div class="form-row">
                <div class="field">
                    <label for="nomeCompleto">Nome completo</label>
                    <input type="text" id="nomeCompleto" maxlength="80" placeholder="Ex.: Ana Souza">
                </div>
                <div class="field">
                    <label for="idade">Idade</label>
                    <input type="number" id="idade" min="10" max="100" placeholder="Ex.: 35">
                </div>
                <div class="field">
                    <label for="dataAplicacao">Data</label>
                    <input type="date" id="dataAplicacao">
                </div>
            </div>
            <p class="helper">
                Voc√™ poder√° revisar todas as respostas antes de gerar seus resultados. O nome completo √© √∫til para
                organizar a mensagem ao psic√≥logo, mas n√£o bloqueia o uso se for deixado em branco.
            </p>
            <div class="btn-row">
                <button class="btn btn-primary" id="goQuestionnaire">Iniciar question√°rio</button>
                <button class="btn btn-secondary" id="backToConsent">Voltar</button>
            </div>
        </section>

        <!-- QUESTION√ÅRIO -->
        <section id="questionnaireSection" class="card hidden" tabindex="-1">
            <div class="card-header">
                <div class="card-title">Question√°rio</div>
                <span class="card-tag" id="blockTag">Bloco 1</span>
            </div>
            <p class="muted">
                Leia cada afirma√ß√£o e marque o quanto ela descreve voc√™ no √∫ltimo ano. N√£o h√° respostas ‚Äúcertas‚Äù ou ‚Äúerradas‚Äù.
                Procure responder com base no que voc√™ realmente sente, mais do que no que pensa que ‚Äúdeveria‚Äù sentir.
            </p>
            <p class="muted">
                <span class="tooltip" title="Algumas pessoas se baseiam mais no que sentem do que no que pensam. Aqui, d√™ prioridade ao que voc√™ sente.">
                    <strong>Escala de resposta</strong>
                </span>:
            </p>
            <ul class="muted" style="padding-left:18px;margin-top:2px;">
                <li>1 ‚Äì Completamente falso sobre mim</li>
                <li>2 ‚Äì Em grande parte falso sobre mim</li>
                <li>3 ‚Äì Mais falso do que verdadeiro</li>
                <li>4 ‚Äì Mais verdadeiro do que falso</li>
                <li>5 ‚Äì Em grande parte verdadeiro sobre mim</li>
                <li>6 ‚Äì Completamente verdadeiro sobre mim</li>
            </ul>

            <div class="progress-wrapper">
                <div class="progress-bar">
                    <div class="progress-inner" id="progressInner"></div>
                </div>
                <div class="muted" id="progressText" style="margin-top:4px;font-size:0.8rem;"></div>
            </div>

            <div id="questionsContainer"></div>

            <div class="btn-row">
                <button class="btn btn-secondary" id="prevBlock">Anterior</button>
                <button class="btn btn-primary" id="nextBlock">Pr√≥ximo bloco</button>
            </div>
        </section>

        <!-- REVIS√ÉO -->
        <section id="reviewSection" class="card hidden">
            <div class="card-header">
                <div class="card-title">Revisar respostas</div>
                <span class="card-tag">Passo 4 de 4</span>
            </div>
            <p class="muted" id="reviewSummary"></p>
            <div id="missingList" class="muted" style="font-size:0.8rem;"></div>
            <div class="btn-row">
                <button class="btn btn-secondary" id="backToQuestions">Voltar ao question√°rio</button>
                <button class="btn btn-primary" id="calculateResults">Corrigir e gerar resultados</button>
            </div>
        </section>

        <!-- RESULTADOS -->
        <section id="resultsSection" class="card hidden">
            <div class="card-header">
                <div class="card-title">Seus resultados</div>
                <span class="card-tag">Resumo cl√≠nico</span>
            </div>
            <p class="muted" id="resultsIntro"></p>

            <div class="section-title">Esquemas por status e estilo de enfrentamento</div>
            <p class="muted">
                Cada esquema pode aparecer como <span class="status-chip status-ativo">ativo</span>,
                <span class="status-chip status-latente">latente</span> ou
                <span class="status-chip status-ausente">ausente</span>.
                ‚ÄúAtivo‚Äù indica maior probabilidade de estar contribuindo para o sofrimento atual; ‚Äúlatente‚Äù aponta uma
                vulnerabilidade que costuma ser acionada em situa√ß√µes espec√≠ficas; ‚Äúausente‚Äù significa que, neste momento,
                esse padr√£o n√£o aparece como foco central de cuidado.
            </p>
            <p class="muted">
                Al√©m disso, o instrumento estima o <strong>estilo de enfrentamento predominante</strong> diante de cada esquema:
                <strong>Resignado(a)</strong> (submete-se ao padr√£o como se fosse verdade absoluta),
                <strong>Evitativo(a)</strong> (foge de situa√ß√µes, pessoas ou emo√ß√µes que ativam o esquema) ou
                <strong>Hipercompensador(a)</strong> (reage no extremo oposto, muitas vezes de forma r√≠gida ou exagerada).
            </p>

            <div id="resultsTableWrapper"></div>

            <div style="margin-top:16px;">
                <div class="section-title">Gr√°fico de escores por esquema</div>
                <div style="height:380px;max-height:420px;">
                    <canvas id="schemasChart"></canvas>
                </div>
            </div>

            <div style="margin-top:16px;">
                <div class="section-title">Psicoeduca√ß√£o geral sobre esquemas e estilos</div>
                <p class="muted">
                    Os <strong>Esquemas Iniciais Desadaptativos</strong> costumam nascer de experi√™ncias em que necessidades emocionais b√°sicas
                    (seguran√ßa, afeto, pertencimento, autonomia, limites saud√°veis, express√£o emocional) n√£o foram suficientemente
                    atendidas. O c√©rebro registra essas experi√™ncias como ‚Äúmapas‚Äù para prever o mundo e, por isso, tendemos a
                    repetir respostas antigas mesmo quando o contexto atual j√° √© diferente.
                </p>
                <p class="muted">
                    Um esquema pode estar <strong>ativo</strong> (aparece com frequ√™ncia e intensidade), <strong>latente</strong> (fica em segundo plano e
                    √© disparado por gatilhos espec√≠ficos) ou praticamente <strong>ausente</strong>. Isso n√£o determina quem voc√™ √©, mas indica
                    √°reas em que vale investir em autoconhecimento e psicoterapia.
                </p>
                <p class="muted">
                    Tamb√©m √© importante observar <strong>como</strong> voc√™ lida com o esquema. No modo <strong>resignado</strong>, a pessoa se adapta ao
                    padr√£o (‚Äú√© assim mesmo‚Äù) e refor√ßa a hist√≥ria dolorosa. No modo <strong>evitativo</strong>, foge de situa√ß√µes, pessoas ou
                    emo√ß√µes que poderiam ativar o esquema, o que alivia no curto prazo, mas mant√©m o problema no longo prazo. No
                    modo <strong>hipercompensador</strong>, reage na dire√ß√£o oposta (ex.: virar extremamente controlador para n√£o se sentir
                    abandonado), o que d√° sensa√ß√£o de for√ßa, mas costuma gerar conflitos e desgaste.
                </p>
                <p class="muted">
                    Em psicoterapia, o trabalho envolve reconhecer esses padr√µes, desenvolver uma postura interna mais cuidadosa
                    consigo mesmo(a) e construir respostas novas, mais alinhadas com a vida que voc√™ deseja viver hoje ‚Äì e n√£o
                    apenas com as hist√≥rias que precisou criar para sobreviver no passado.
                </p>
            </div>

            <div style="margin-top:16px;" id="perSchemaPsychoWrapper">
                <div class="section-title">Entendendo seus esquemas ativos</div>
                <div class="muted" id="perSchemaPsycho"></div>
            </div>
        </section>

        <!-- A√á√ïES FINAIS -->
        <section id="actionsSection" class="card hidden">
            <div class="card-header">
                <div class="card-title">Exportar e compartilhar</div>
                <span class="card-tag">Pr√≥ximos passos</span>
            </div>
            <p class="muted">
                Voc√™ pode enviar um resumo dos seus resultados diretamente para seu psic√≥logo via WhatsApp ou salvar as
                informa√ß√µes para a sua pr√≥pria reflex√£o em terapia.
            </p>
            <div class="btn-row">
                <button class="btn btn-whatsapp" id="sendWhatsApp">Enviar resumo ao meu psic√≥logo</button>
                <button class="btn btn-secondary" id="sharePageWhatsApp">Compartilhar esta p√°gina com amigos</button>
            </div>
        </section>

        <footer>
            <div>¬© 2025 Richelmy Murta - Todos os direitos reservados</div>
            <div class="footer-note">Este guia √© um recurso psicoeducativo de apoio e n√£o substitui psicoterapia, atendimento de emerg√™ncia ou acompanhamento m√©dico/psiqui√°trico.</div>
        </footer>
    </div>

    <script>
        // =========================
        // TEMA CLARO/ESCURO
        // =========================
        const themeToggle = document.getElementById('themeToggle');
        const storedTheme = localStorage.getItem('mapaEsquemasTheme');

        if (storedTheme === 'dark') {
            document.body.classList.add('theme-dark');
        }

        if (themeToggle) {
            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('theme-dark');
                localStorage.setItem(
                    'mapaEsquemasTheme',
                    document.body.classList.contains('theme-dark') ? 'dark' : 'light'
                );
                if (window.schemasChartInstance) {
                    applyChartTheme(window.schemasChartInstance);
                    window.schemasChartInstance.update();
                }
            });
        }

        // =========================
        // MODAL "SAIBA MAIS"
        // =========================
        const learnEidsBtn = document.getElementById('learnEidsBtn');
        const eidsModal = document.getElementById('eidsModal');
        const closeEidsModal = document.getElementById('closeEidsModal');
        const closeEidsModal2 = document.getElementById('closeEidsModal2');
        const eidsBackdrop = eidsModal ? eidsModal.querySelector('.modal-backdrop') : null;

        function openEidsModal() {
            if (!eidsModal) return;
            eidsModal.classList.remove('hidden');
            eidsModal.setAttribute('aria-hidden', 'false');
        }

        function closeEids() {
            if (!eidsModal) return;
            eidsModal.classList.add('hidden');
            eidsModal.setAttribute('aria-hidden', 'true');
        }

        if (learnEidsBtn) learnEidsBtn.addEventListener('click', openEidsModal);
        if (closeEidsModal) closeEidsModal.addEventListener('click', closeEids);
        if (closeEidsModal2) closeEidsModal2.addEventListener('click', closeEids);
        if (eidsBackdrop) eidsBackdrop.addEventListener('click', closeEids);

        // =========================
        // NAVEGA√á√ÉO DE SE√á√ïES
        // =========================
        const introSection = document.getElementById('introSection');
        const consentSection = document.getElementById('consentSection');
        const userdataSection = document.getElementById('userdataSection');
        const questionnaireSection = document.getElementById('questionnaireSection');
        const reviewSection = document.getElementById('reviewSection');
        const resultsSection = document.getElementById('resultsSection');
        const actionsSection = document.getElementById('actionsSection');

        const goConsent = document.getElementById('goConsent');
        const backToIntro = document.getElementById('backToIntro');
        const acceptConsent = document.getElementById('acceptConsent');
        const goQuestionnaire = document.getElementById('goQuestionnaire');
        const backToConsent = document.getElementById('backToConsent');
        const backToQuestions = document.getElementById('backToQuestions');

        function scrollToQuestionnaire() {
            if (!questionnaireSection) return;
            questionnaireSection.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
            questionnaireSection.focus({
                preventScroll: true
            });
        }

        if (goConsent) {
            goConsent.addEventListener('click', () => {
                introSection.classList.add('hidden');
                consentSection.classList.remove('hidden');
            });
        }

        if (backToIntro) {
            backToIntro.addEventListener('click', () => {
                consentSection.classList.add('hidden');
                introSection.classList.remove('hidden');
            });
        }

        if (acceptConsent) {
            acceptConsent.addEventListener('click', () => {
                consentSection.classList.add('hidden');
                userdataSection.classList.remove('hidden');
            });
        }

        if (backToConsent) {
            backToConsent.addEventListener('click', () => {
                userdataSection.classList.add('hidden');
                consentSection.classList.remove('hidden');
            });
        }

        if (backToQuestions) {
            backToQuestions.addEventListener('click', () => {
                reviewSection.classList.add('hidden');
                questionnaireSection.classList.remove('hidden');
                scrollToQuestionnaire();
            });
        }

        // =========================
        // DADOS B√ÅSICOS
        // =========================
        const nomeInput = document.getElementById('nomeCompleto');
        const idadeInput = document.getElementById('idade');
        const dataInput = document.getElementById('dataAplicacao');

        // =========================
        // ESQUEMAS (18 EIDs)
        // =========================
        const schemas = [{
                id: 'PE',
                nome: 'Priva√ß√£o Emocional',
                dominio: 'Desconex√£o e Rejei√ß√£o',
                descricao_curta: 'Sensa√ß√£o de que as necessidades emocionais b√°sicas n√£o ser√£o atendidas de forma est√°vel.'
            },
            {
                id: 'AB',
                nome: 'Abandono/Instabilidade',
                dominio: 'Desconex√£o e Rejei√ß√£o',
                descricao_curta: 'Medo intenso de ser abandonado(a) ou de que as pessoas importantes desapare√ßam.'
            },
            {
                id: 'DA',
                nome: 'Desconfian√ßa/Abuso',
                dominio: 'Desconex√£o e Rejei√ß√£o',
                descricao_curta: 'Expectativa de que os outros ir√£o machucar, enganar ou humilhar.'
            },
            {
                id: 'SI',
                nome: 'Isolamento Social/Aliena√ß√£o',
                dominio: 'Desconex√£o e Rejei√ß√£o',
                descricao_curta: 'Sentir-se diferente, exclu√≠do(a) ou desconectado(a) dos grupos.'
            },
            {
                id: 'DI',
                nome: 'Defectividade/Vergonha',
                dominio: 'Desconex√£o e Rejei√ß√£o',
                descricao_curta: 'Sentimento de ser defeituoso(a), inferior ou indigno(a) de amor.'
            },

            {
                id: 'FD',
                nome: 'Fracasso',
                dominio: 'Autonomia e Desempenho Prejudicados',
                descricao_curta: 'Cren√ßa de que √© um fracasso ou n√£o ser√° capaz de ter sucesso como os outros.'
            },
            {
                id: 'DIIN',
                nome: 'Depend√™ncia/Incompet√™ncia',
                dominio: 'Autonomia e Desempenho Prejudicados',
                descricao_curta: 'Sentir-se incapaz de lidar sozinho(a) com tarefas e responsabilidades di√°rias.'
            },
            {
                id: 'VV',
                nome: 'Vulnerabilidade ao Dano/Doen√ßa',
                dominio: 'Autonomia e Desempenho Prejudicados',
                descricao_curta: 'Medo intenso de cat√°strofes, doen√ßas graves ou acidentes.'
            },
            {
                id: 'EM',
                nome: 'Emaranhamento/Self Subdesenvolvido',
                dominio: 'Autonomia e Desempenho Prejudicados',
                descricao_curta: 'Dificuldade em sentir-se separado(a) emocionalmente de pessoas importantes.'
            },

            {
                id: 'SB',
                nome: 'Subjuga√ß√£o',
                dominio: 'Outrifica√ß√£o',
                descricao_curta: 'Tend√™ncia a ceder demais √†s vontades dos outros, com medo de conflitos ou rejei√ß√£o.'
            },
            {
                id: 'SA',
                nome: 'Autossacrif√≠cio',
                dominio: 'Outrifica√ß√£o',
                descricao_curta: 'Colocar as necessidades dos outros sempre √† frente das pr√≥prias, mesmo com custo emocional.'
            },
            {
                id: 'AP',
                nome: 'Aprova√ß√£o/Busca por Reconhecimento',
                dominio: 'Outrifica√ß√£o',
                descricao_curta: 'Necessidade intensa de agradar e ser aprovado(a) para se sentir valioso(a).'
            },

            {
                id: 'EC',
                nome: 'Direitos Elevados/Grandiosidade',
                dominio: 'Limites Prejudicados',
                descricao_curta: 'Sentimento de ser especial, com direito a privil√©gios e regras diferentes.'
            },
            {
                id: 'AI',
                nome: 'Autocontrole/Autodisciplina Insuficientes',
                dominio: 'Limites Prejudicados',
                descricao_curta: 'Dificuldade em tolerar frustra√ß√µes, cumprir rotinas e controlar impulsos.'
            },

            {
                id: 'NP',
                nome: 'Negatividade/Pessimismo',
                dominio: 'Supervigil√¢ncia e Inibi√ß√£o',
                descricao_curta: 'Foco excessivo no lado negativo, riscos e poss√≠veis problemas.'
            },
            {
                id: 'IE',
                nome: 'Inibi√ß√£o Emocional',
                dominio: 'Supervigil√¢ncia e Inibi√ß√£o',
                descricao_curta: 'Tend√™ncia a bloquear sentimentos e espontaneidade para evitar cr√≠ticas ou vergonha.'
            },
            {
                id: 'PC',
                nome: 'Padr√µes Inflex√≠veis/Cr√≠tica Exagerada',
                dominio: 'Supervigil√¢ncia e Inibi√ß√£o',
                descricao_curta: 'Busca r√≠gida por perfei√ß√£o, alto desempenho e regras, com autocr√≠tica intensa.'
            },
            {
                id: 'PCO',
                nome: 'Punitividade',
                dominio: 'Supervigil√¢ncia e Inibi√ß√£o',
                descricao_curta: 'Cren√ßa de que erros merecem puni√ß√£o dura, com pouca toler√¢ncia a falhas.'
            }
        ];

        // =========================
        // PSICOEDUCA√á√ÉO POR ESQUEMA
        // =========================
        const schemaPsycho = {
            PE: {
                titulo: 'Priva√ß√£o Emocional',
                definicao: 'A pessoa sente, de forma cr√¥nica, que ningu√©m realmente a acolhe, cuida ou compreende. √â como se sempre faltasse calor emocional, mesmo em rela√ß√µes importantes.',
                origem: 'Costuma se desenvolver em contextos em que as figuras de cuidado foram frias, distantes, muito ocupadas ou pouco sens√≠veis √†s necessidades afetivas.',
                resignado: 'Aceita rela√ß√µes frias, se acostuma com pouco carinho e internaliza a ideia de que ‚Äún√£o adianta pedir nada, ningu√©m vai cuidar de mim‚Äù.',
                evitativo: 'Evita demonstrar necessidades, distancia-se emocionalmente ou se anestesia com trabalho, telas, consumos ou distra√ß√µes para n√£o sentir a car√™ncia.',
                hipercompensador: 'Adota postura de for√ßa extrema e autossufici√™ncia, desdenhando de quem precisa de apoio, ao mesmo tempo em que esconde uma forte necessidade de ser cuidado(a).'
            },
            AB: {
                titulo: 'Abandono/Instabilidade',
                definicao: 'Medo intenso de que pessoas importantes se afastem, morram, troquem por outra ou deixem de amar. A proximidade afetiva parece sempre inst√°vel.',
                origem: 'Geralmente ligado a separa√ß√µes, perdas, muita instabilidade relacional, pais imprevis√≠veis ou v√≠nculos em que a pessoa se sentiu facilmente substitu√≠vel.',
                resignado: 'Tolera rela√ß√µes inseguras, ciumentas ou intermitentes, aceitando migalhas de presen√ßa por medo de ficar s√≥.',
                evitativo: 'Evita se apegar profundamente, corta v√≠nculos cedo ou se envolve com pessoas indispon√≠veis para n√£o sentir o risco real de abandono.',
                hipercompensador: 'Torna-se controlador(a), ciumento(a), testa a lealdade do outro, cria crises ou dramatiza situa√ß√µes para garantir provas de que n√£o ser√° abandonado(a).'
            },
            DA: {
                titulo: 'Desconfian√ßa/Abuso',
                definicao: 'Expectativa de que, cedo ou tarde, algu√©m ir√° machucar, enganar, humilhar ou se aproveitar. A tend√™ncia √© interpretar o mundo como perigoso e hostil.',
                origem: 'Comum em hist√≥rias com abuso f√≠sico, sexual, emocional, bullying, humilha√ß√µes ou ambientes muito imprevis√≠veis e agressivos.',
                resignado: 'Tolera rela√ß√µes em que √© maltratado(a), acreditando que ‚Äú√© assim mesmo‚Äù, ou que todos v√£o ferir de algum modo.',
                evitativo: 'Fecha-se emocionalmente, evita intimidade, n√£o compartilha vulnerabilidades para n√£o oferecer ‚Äúmaterial‚Äù que possa ser usado contra si.',
                hipercompensador: 'Ataca primeiro, vive na defensiva, testa a lealdade das pessoas e pode parecer hostil, ir√¥nico(a) ou agressivo(a) para n√£o ser pego de surpresa.'
            },
            SI: {
                titulo: 'Isolamento Social/Aliena√ß√£o',
                definicao: 'Sensa√ß√£o persistente de ser diferente, estranho(a) ou de n√£o pertencer a grupos, fam√≠lias ou ambientes sociais.',
                origem: 'Pode surgir em contextos de rejei√ß√£o social, bullying, mudan√ßas frequentes de ambiente ou fam√≠lias em que a pessoa se sentia ‚Äúfora do padr√£o‚Äù.',
                resignado: 'Assume que n√£o pertence, se conforma em ficar √† margem, participa pouco e internaliza a ideia de que ‚Äún√£o sou como os outros‚Äù.',
                evitativo: 'Evita festas, grupos, exposi√ß√µes p√∫blicas, ficando mais isolado(a) para n√£o se sentir deslocado(a) ou rejeitado(a).',
                hipercompensador: 'Adota uma postura de ‚Äúdiferent√£o(a)‚Äù, exc√™ntrico(a) ou superior, usando isso como armadura para lidar com a dor de n√£o se sentir inclu√≠do(a).'
            },
            DI: {
                titulo: 'Defectividade/Vergonha',
                definicao: 'Viv√™ncia profunda de ser defeituoso(a), inadequado(a), indigno(a) de amor ou aceita√ß√£o, com forte vergonha de quem se √©.',
                origem: 'Comum em fam√≠lias muito cr√≠ticas, r√≠gidas, com humilha√ß√µes, compara√ß√µes ou mensagens expl√≠citas de que a pessoa ‚Äún√£o √© boa o bastante‚Äù.',
                resignado: 'Aceita rela√ß√µes em que √© desvalorizado(a), tolera cr√≠ticas duras, sente-se naturalmente menor ou menos digno(a) que os outros.',
                evitativo: 'Esconde partes da hist√≥ria, evita intimidade verdadeira, usa m√°scaras sociais para que ningu√©m conhe√ßa suas ‚Äúfalhas reais‚Äù.',
                hipercompensador: 'Assume postura arrogante, perfeccionista ou grandiosa para encobrir a sensa√ß√£o interna de defeito, afastando quem poderia se aproximar de forma aut√™ntica.'
            },
            FD: {
                titulo: 'Fracasso',
                definicao: 'Cren√ßa de que √© menos capaz, inteligente ou competente que os outros, com expectativa intensa de falhar em √°reas importantes.',
                origem: 'Frequentemente vinculado a cr√≠ticas sobre desempenho, compara√ß√µes constantes com irm√£os/colegas ou falta de apoio nas dificuldades de aprendizado.',
                resignado: 'Evita tentar, se posiciona como ‚Äúincapaz‚Äù, aceita pap√©is menores e se acostuma com a identidade de quem n√£o d√° conta.',
                evitativo: 'Foge de desafios, provas, concursos, projetos maiores, preferindo n√£o arriscar para n√£o confirmar a cren√ßa de fracasso.',
                hipercompensador: 'Trabalha em excesso, estuda demais ou busca altas conquistas para provar que n√£o √© um fracasso, mas sem conseguir se sentir suficientemente bom.'
            },
            DIIN: {
                titulo: 'Depend√™ncia/Incompet√™ncia',
                definicao: 'Sensa√ß√£o de n√£o conseguir lidar sozinho(a) com decis√µes, responsabilidades e tarefas da vida adulta.',
                origem: 'Surge em contextos de superprote√ß√£o, controle excessivo, desautoriza√ß√£o das iniciativas da crian√ßa ou falta de oportunidades de experimentar autonomia.',
                resignado: 'Assume o papel de dependente, pedindo que outros decidam ou resolvam, refor√ßando a cren√ßa de incapacidade.',
                evitativo: 'Adia decis√µes, evita assumir responsabilidades ou aprender coisas novas, preferindo que algu√©m ‚Äúassuma o volante‚Äù.',
                hipercompensador: 'Torna-se controlador(a), centralizador(a) e aparentemente muito seguro(a) para esconder medos de n√£o dar conta sozinho(a).'
            },
            VV: {
                titulo: 'Vulnerabilidade ao Dano/Doen√ßa',
                definicao: 'Medo intenso e frequente de cat√°strofes, acidentes, doen√ßas graves ou perdas repentinas.',
                origem: 'Pode estar ligado a hist√≥rico de doen√ßas na fam√≠lia, experi√™ncias traum√°ticas, perdas inesperadas ou ambientes em que se falava muito sobre trag√©dias.',
                resignado: 'Vive em estado de alerta, aceita a ideia de que o mundo √© extremamente perigoso e de que algo ruim est√° sempre prestes a acontecer.',
                evitativo: 'Evita lugares, not√≠cias, exames ou atividades que possam aumentar a sensa√ß√£o de risco, o que alivia a ansiedade, mas mant√©m o medo.',
                hipercompensador: 'Busca excesso de informa√ß√µes, checagens e controles, impondo regras r√≠gidas a si e aos outros para tentar ‚Äúgarantir seguran√ßa total‚Äù.'
            },
            EM: {
                titulo: 'Emaranhamento/Self Subdesenvolvido',
                definicao: 'Dificuldade em sentir-se separado(a) emocionalmente de figuras importantes, com pouca clareza de identidade pr√≥pria.',
                origem: 'Geralmente em fam√≠lias muito fusionadas, com pouco incentivo √† autonomia, ou em rela√ß√µes em que havia culpa por se diferenciar.',
                resignado: 'Abre m√£o de desejos e projetos pessoais para manter proximidade, aceitando viver ‚Äúem fun√ß√£o‚Äù de algu√©m.',
                evitativo: 'Evita movimentos de individua√ß√£o (morar sozinho, tomar decis√µes pr√≥prias) por medo de afastar ou magoar pessoas importantes.',
                hipercompensador: 'Em alguns momentos rompe de forma brusca, assumindo postura de independ√™ncia extrema para provar que n√£o precisa de ningu√©m.'
            },
            SB: {
                titulo: 'Subjuga√ß√£o',
                definicao: 'Padr√£o de se colocar em segundo plano por medo de puni√ß√£o, raiva ou abandono, cedendo demais √†s vontades dos outros.',
                origem: 'Comum em lares autorit√°rios, com figuras dominadoras, explosivas ou pouco abertas ao di√°logo.',
                resignado: 'Diz pouco ‚Äún√£o‚Äù, aceita decis√µes injustas e internaliza a ideia de que seus desejos valem menos.',
                evitativo: 'Evita confrontos, engole raiva, silencia opini√µes e se adapta para manter a paz a qualquer custo.',
                hipercompensador: 'Ap√≥s longos per√≠odos de submiss√£o, pode explodir, tornar-se controladora ou autorit√°ria em algumas rela√ß√µes para n√£o se sentir t√£o impotente.'
            },
            SA: {
                titulo: 'Autossacrif√≠cio',
                definicao: 'Tend√™ncia a colocar o bem-estar dos outros sempre acima do pr√≥prio, mesmo com alto custo emocional ou f√≠sico.',
                origem: 'Frequentemente em contextos em que a pessoa foi valorizada por ‚Äúser forte‚Äù, ‚Äúajudar todos‚Äù ou responsabilizada precocemente pelos outros.',
                resignado: 'Aceita viver exausto(a), cuidando de todos, e sente culpa ao tentar priorizar a si mesmo(a).',
                evitativo: 'Evita pedir ajuda, esconde cansa√ßo ou sofrimento, mantendo o foco constante nas demandas alheias.',
                hipercompensador: 'Pode exibir, em alguns momentos, o quanto se sacrifica, esperando reconhecimento ou reagindo com ressentimento quando n√£o recebe o mesmo em troca.'
            },
            AP: {
                titulo: 'Aprova√ß√£o/Busca por Reconhecimento',
                definicao: 'Necessidade intensa de ser aprovado(a), admirado(a) ou reconhecido(a) para se sentir valioso(a).',
                origem: 'Geralmente associada a ambientes em que amor e aten√ß√£o eram condicionados a desempenho, apar√™ncia ou agradar os outros.',
                resignado: 'Baseia a autoestima quase exclusivamente na opini√£o externa, mudando muito conforme o feedback que recebe.',
                evitativo: 'Esconde vulnerabilidades, monta ‚Äúpersonagens‚Äù sociais e evita situa√ß√µes em que possa ser mal avaliado(a).',
                hipercompensador: 'Busca destaque, admira√ß√£o, conquistas ou visibilidade, √†s vezes competindo e disputando aten√ß√£o para garantir sensa√ß√£o de valor.'
            },
            EC: {
                titulo: 'Direitos Elevados/Grandiosidade',
                definicao: 'Sensa√ß√£o de ser especial, com direito a privil√©gios, regras diferentes ou tratamento preferencial.',
                origem: 'Pode surgir em contextos de muita permissividade, idealiza√ß√£o excessiva ou falta de limites claros, ou como defesa contra sentimentos profundos de inferioridade.',
                resignado: 'Aceita a ideia de que merece mais do que os outros, mesmo percebendo que isso pode gerar conflitos.',
                evitativo: 'Evita tarefas e responsabilidades consideradas ‚Äúinferiores‚Äù ou pouco compat√≠veis com a autoimagem de import√¢ncia.',
                hipercompensador: 'Imp√µe vontades, ultrapassa limites, espera privil√©gios e pode tratar os outros como extens√µes de si, refor√ßando o sentimento de superioridade.'
            },
            AI: {
                titulo: 'Autocontrole/Autodisciplina Insuficientes',
                definicao: 'Dificuldade em tolerar frustra√ß√µes, adiar gratifica√ß√µes e manter rotinas est√°veis, com tend√™ncia a buscar al√≠vio imediato.',
                origem: 'Relaciona-se com falta de limites consistentes na inf√¢ncia, pouca estrutura ou, em alguns casos, uso de impulsividade como fuga de emo√ß√µes dolorosas.',
                resignado: 'V√™ a si mesmo(a) como ‚Äúsem for√ßa de vontade‚Äù, aceitando repetidos ciclos de abandono de metas e projetos.',
                evitativo: 'Evita tarefas que exigem esfor√ßo prolongado, planejamento ou disciplina, priorizando o que d√° prazer r√°pido.',
                hipercompensador: 'Entra em fases de rigidez extrema, com regras duras e hiperprodutividade, tentando compensar per√≠odos de falta de controle.'
            },
            NP: {
                titulo: 'Negatividade/Pessimismo',
                definicao: 'Foco predominante nos aspectos negativos, riscos, perdas e problemas, com dificuldade em perceber possibilidades positivas.',
                origem: 'Comum em ambientes marcados por crises, perdas, cr√≠ticas constantes, preocupa√ß√£o excessiva ou pouco espa√ßo para alegria.',
                resignado: 'Enxerga a vida como um lugar essencialmente perigoso ou frustrante, sentindo que ‚Äúas coisas boas n√£o duram‚Äù.',
                evitativo: 'Evita investir em projetos ou rela√ß√µes com medo de se decepcionar, preferindo n√£o criar expectativas.',
                hipercompensador: 'Assume o papel de ‚Äúvoz da realidade dura‚Äù, apontando defeitos e riscos em tudo, o que pode proteger de frustra√ß√µes, mas tamb√©m roubar esperan√ßa.'
            },
            IE: {
                titulo: 'Inibi√ß√£o Emocional',
                definicao: 'Bloqueio frequente de emo√ß√µes, espontaneidade e necessidades pessoais, para evitar cr√≠ticas, vergonha ou desorganiza√ß√£o.',
                origem: 'Geralmente associada a ambientes em que expressar sentimentos era visto como fraqueza, exagero ou algo inadequado.',
                resignado: 'Internaliza a ideia de que sentir e expressar emo√ß√µes √© perigoso ou vergonhoso, tornando-se contido(a) e controlado(a).',
                evitativo: 'Foge de conversas profundas, muda de assunto ou se refugia no racional para n√£o entrar em contato com o que sente.',
                hipercompensador: 'Usa humor, ironia ou uma postura aparentemente ‚Äúfria‚Äù para manter dist√¢ncia de experi√™ncias emocionais mais vulner√°veis.'
            },
            PC: {
                titulo: 'Padr√µes Inflex√≠veis/Cr√≠tica Exagerada',
                definicao: 'Busca r√≠gida por perfei√ß√£o, alto desempenho e regras, com autocr√≠tica intensa e pouco espa√ßo para descanso ou erro.',
                origem: 'Comum em fam√≠lias muito exigentes, cr√≠ticas, competitivas ou centradas em produtividade e resultados.',
                resignado: 'Sente que precisa estar sempre produzindo ou melhorando algo, com grande dificuldade para relaxar sem culpa.',
                evitativo: 'Adia projetos por medo de n√£o alcan√ßar o padr√£o ideal, revisa em excesso detalhes e se prende em corre√ß√µes intermin√°veis.',
                hipercompensador: 'Critica com dureza a si e os outros quando percebe falhas, impondo padr√µes muito altos ao ambiente ao redor.'
            },
            PCO: {
                titulo: 'Punitividade',
                definicao: 'Tend√™ncia a ver erros como merecedores de puni√ß√£o dura, com pouca toler√¢ncia para fragilidade humana ou compaix√£o.',
                origem: 'Frequentemente associada a contextos em que falhas eram tratadas com severidade, humilha√ß√£o, castigos r√≠gidos ou pouco acolhimento.',
                resignado: 'Aplica sobre si a mesma dureza, acreditando que s√≥ cr√≠ticas fortes fazem algu√©m melhorar.',
                evitativo: 'Evita situa√ß√µes em que possa errar ou ser avaliado, escondendo falhas para n√£o entrar em contato com a sensa√ß√£o de culpa e puni√ß√£o.',
                hipercompensador: 'Torna-se muito cr√≠tico(a), duro(a) ou punitivo(a) com os outros, replicando o padr√£o que aprendeu e tendo pouca paci√™ncia com limita√ß√µes humanas.'
            }
        };

        // =========================
        // ITENS ‚Äì 108 QUEST√ïES
        // =========================
        const questions = [
            // PRIVACAO EMOCIONAL (PE) ‚Äì 6
            {
                id: 'Q01',
                number: 1,
                schemaId: 'PE',
                text: 'Costumo sentir que, nas minhas rela√ß√µes mais importantes, falta carinho ou acolhimento emocional.',
                styleHint: 'R'
            },
            {
                id: 'Q02',
                number: 2,
                schemaId: 'PE',
                text: 'Mesmo quando estou perto de algu√©m, frequentemente me sinto emocionalmente sozinho(a).',
                styleHint: 'R'
            },
            {
                id: 'Q03',
                number: 3,
                schemaId: 'PE',
                text: 'Evito pedir apoio emocional porque penso que vou incomodar ou n√£o serei compreendido(a).',
                styleHint: 'E'
            },
            {
                id: 'Q04',
                number: 4,
                schemaId: 'PE',
                text: 'Para n√£o sentir falta de cuidado, muitas vezes me afasto em sil√™ncio ou finjo que est√° tudo bem.',
                styleHint: 'E'
            },
            {
                id: 'Q05',
                number: 5,
                schemaId: 'PE',
                text: '√Äs vezes ajo como se n√£o precisasse de ningu√©m, para n√£o mostrar que me sinto carente de afeto.',
                styleHint: 'H'
            },
            {
                id: 'Q06',
                number: 6,
                schemaId: 'PE',
                text: 'Costumo me orgulhar de ser ‚Äúforte‚Äù e autossuficiente, mesmo quando por dentro sinto car√™ncia emocional.',
                styleHint: 'H'
            },

            // ABANDONO (AB) ‚Äì 6
            {
                id: 'Q07',
                number: 7,
                schemaId: 'AB',
                text: 'Tenho medo constante de que as pessoas de quem mais dependo acabem se afastando de mim.',
                styleHint: 'R'
            },
            {
                id: 'Q08',
                number: 8,
                schemaId: 'AB',
                text: 'Quando algu√©m se distancia ou demora a responder, fico inseguro(a) sobre o quanto ainda se importa comigo.',
                styleHint: 'R'
            },
            {
                id: 'Q09',
                number: 9,
                schemaId: 'AB',
                text: 'Evito me apegar demais √†s pessoas para n√£o sofrer se elas forem embora.',
                styleHint: 'E'
            },
            {
                id: 'Q10',
                number: 10,
                schemaId: 'AB',
                text: '√Äs vezes me afasto primeiro ou termino v√≠nculos para n√£o correr o risco de ser abandonado(a).',
                styleHint: 'E'
            },
            {
                id: 'Q11',
                number: 11,
                schemaId: 'AB',
                text: 'Posso ficar controlador(a) ou ciumento(a) para garantir que as pessoas importantes continuem por perto.',
                styleHint: 'H'
            },
            {
                id: 'Q12',
                number: 12,
                schemaId: 'AB',
                text: 'Costumo testar o quanto algu√©m gosta de mim, criando situa√ß√µes para ver se a pessoa continua comigo.',
                styleHint: 'H'
            },

            // DESCONFIAN√áA/ABUSO (DA) ‚Äì 6
            {
                id: 'Q13',
                number: 13,
                schemaId: 'DA',
                text: '√â dif√≠cil acreditar que as pessoas n√£o v√£o se aproveitar de mim se eu me abrir demais.',
                styleHint: 'R'
            },
            {
                id: 'Q14',
                number: 14,
                schemaId: 'DA',
                text: 'Com frequ√™ncia imagino que h√° inten√ß√µes ocultas ou segundas inten√ß√µes no comportamento dos outros.',
                styleHint: 'R'
            },
            {
                id: 'Q15',
                number: 15,
                schemaId: 'DA',
                text: 'Evito falar de assuntos pessoais porque temo que isso seja usado contra mim no futuro.',
                styleHint: 'E'
            },
            {
                id: 'Q16',
                number: 16,
                schemaId: 'DA',
                text: 'Prefiro manter dist√¢ncia emocional para n√£o correr o risco de ser enganado(a) ou humilhado(a).',
                styleHint: 'E'
            },
            {
                id: 'Q17',
                number: 17,
                schemaId: 'DA',
                text: '√Äs vezes fico na defensiva ou ataco primeiro para n√£o parecer vulner√°vel aos outros.',
                styleHint: 'H'
            },
            {
                id: 'Q18',
                number: 18,
                schemaId: 'DA',
                text: 'Costumo testar a lealdade das pessoas, fazendo pequenas provoca√ß√µes ou criando conflitos.',
                styleHint: 'H'
            },

            // ISOLAMENTO SOCIAL (SI) ‚Äì 6
            {
                id: 'Q19',
                number: 19,
                schemaId: 'SI',
                text: 'Na maior parte dos ambientes sociais, sinto que sou diferente ou n√£o perten√ßo ao grupo.',
                styleHint: 'R'
            },
            {
                id: 'Q20',
                number: 20,
                schemaId: 'SI',
                text: 'Geralmente acredito que os outros se encaixam melhor do que eu em festas, grupos ou equipes.',
                styleHint: 'R'
            },
            {
                id: 'Q21',
                number: 21,
                schemaId: 'SI',
                text: 'Evito eventos sociais porque me sinto deslocado(a) ou estranho(a) quando estou com muitas pessoas.',
                styleHint: 'E'
            },
            {
                id: 'Q22',
                number: 22,
                schemaId: 'SI',
                text: 'Costumo ficar mais √† margem das conversas, apenas observando, para n√£o correr o risco de ser rejeitado(a).',
                styleHint: 'E'
            },
            {
                id: 'Q23',
                number: 23,
                schemaId: 'SI',
                text: '√Äs vezes assumo um papel de ‚Äúdiferent√£o‚Äù ou ‚Äúexc√™ntrico‚Äù para lidar com a sensa√ß√£o de n√£o pertencer.',
                styleHint: 'H'
            },
            {
                id: 'Q24',
                number: 24,
                schemaId: 'SI',
                text: 'Em outros momentos tento parecer indiferente aos grupos, como se n√£o me importasse em fazer parte de nada.',
                styleHint: 'H'
            },

            // DEFECTIVIDADE/VERGONHA (DI) ‚Äì 6
            {
                id: 'Q25',
                number: 25,
                schemaId: 'DI',
                text: 'Com frequ√™ncia sinto que h√° algo profundamente errado ou defeituoso em mim.',
                styleHint: 'R'
            },
            {
                id: 'Q26',
                number: 26,
                schemaId: 'DI',
                text: 'Tenho dificuldade em acreditar que algu√©m poderia me conhecer por inteiro e ainda assim me aceitar.',
                styleHint: 'R'
            },
            {
                id: 'Q27',
                number: 27,
                schemaId: 'DI',
                text: 'Evito mostrar meus pensamentos ou sentimentos mais √≠ntimos por vergonha de ser julgado(a).',
                styleHint: 'E'
            },
            {
                id: 'Q28',
                number: 28,
                schemaId: 'DI',
                text: 'Costumo esconder partes da minha hist√≥ria ou de quem sou, para n√£o parecer ‚Äúmenos‚Äù que os outros.',
                styleHint: 'E'
            },
            {
                id: 'Q29',
                number: 29,
                schemaId: 'DI',
                text: '√Äs vezes exagero minhas qualidades ou conquistas para compensar a sensa√ß√£o interna de defeito.',
                styleHint: 'H'
            },
            {
                id: 'Q30',
                number: 30,
                schemaId: 'DI',
                text: 'Em alguns momentos ajo com arrog√¢ncia ou superioridade para esconder o quanto me sinto inadequado(a).',
                styleHint: 'H'
            },

            // FRACASSO (FD) ‚Äì 6
            {
                id: 'Q31',
                number: 31,
                schemaId: 'FD',
                text: 'Comparado(a) √†s outras pessoas, frequentemente me vejo como menos capaz ou competente.',
                styleHint: 'R'
            },
            {
                id: 'Q32',
                number: 32,
                schemaId: 'FD',
                text: 'Costumo esperar que meus projetos n√£o deem certo, mesmo quando me esfor√ßo.',
                styleHint: 'R'
            },
            {
                id: 'Q33',
                number: 33,
                schemaId: 'FD',
                text: 'Evito desafios acad√™micos ou profissionais por medo de falhar e confirmar que sou incapaz.',
                styleHint: 'E'
            },
            {
                id: 'Q34',
                number: 34,
                schemaId: 'FD',
                text: '√Äs vezes deixo de tentar coisas novas porque j√° imagino que n√£o vou conseguir.',
                styleHint: 'E'
            },
            {
                id: 'Q35',
                number: 35,
                schemaId: 'FD',
                text: 'Em alguns momentos trabalho demais ou estudo em excesso para provar que n√£o sou um fracasso.',
                styleHint: 'H'
            },
            {
                id: 'Q36',
                number: 36,
                schemaId: 'FD',
                text: 'Costumo ser muito competitivo(a) para compensar sentimentos de inferioridade em rela√ß√£o aos outros.',
                styleHint: 'H'
            },

            // DEPEND√äNCIA/INCOMPET√äNCIA (DIIN) ‚Äì 6
            {
                id: 'Q37',
                number: 37,
                schemaId: 'DIIN',
                text: 'Muitas vezes sinto que n√£o consigo tomar decis√µes importantes sem a opini√£o de algu√©m.',
                styleHint: 'R'
            },
            {
                id: 'Q38',
                number: 38,
                schemaId: 'DIIN',
                text: 'Tenho a sensa√ß√£o de que, sozinho(a), n√£o dou conta das responsabilidades do dia a dia.',
                styleHint: 'R'
            },
            {
                id: 'Q39',
                number: 39,
                schemaId: 'DIIN',
                text: 'Evito aprender coisas novas porque acho que vou depender de algu√©m para resolver por mim.',
                styleHint: 'E'
            },
            {
                id: 'Q40',
                number: 40,
                schemaId: 'DIIN',
                text: 'Costumo adiar decis√µes esperando que outra pessoa escolha no meu lugar.',
                styleHint: 'E'
            },
            {
                id: 'Q41',
                number: 41,
                schemaId: 'DIIN',
                text: 'Em alguns momentos ajo como muito autoconfiante para que ningu√©m perceba o quanto me sinto inseguro(a).',
                styleHint: 'H'
            },
            {
                id: 'Q42',
                number: 42,
                schemaId: 'DIIN',
                text: '√Äs vezes assumo o controle de tudo, sem pedir ajuda, para evitar qualquer sensa√ß√£o de depend√™ncia.',
                styleHint: 'H'
            },

            // VULNERABILIDADE AO DANO/DOEN√áA (VV) ‚Äì 6
            {
                id: 'Q43',
                number: 43,
                schemaId: 'VV',
                text: 'Frequentemente temo que algo ruim ou inesperado aconte√ßa comigo ou com quem amo.',
                styleHint: 'R'
            },
            {
                id: 'Q44',
                number: 44,
                schemaId: 'VV',
                text: 'Pequenos sintomas f√≠sicos costumam me deixar muito preocupado(a) com doen√ßas graves.',
                styleHint: 'R'
            },
            {
                id: 'Q45',
                number: 45,
                schemaId: 'VV',
                text: 'Evito alguns lugares, trajetos ou atividades por medo de acidentes ou cat√°strofes.',
                styleHint: 'E'
            },
            {
                id: 'Q46',
                number: 46,
                schemaId: 'VV',
                text: 'Fujo de not√≠cias ou conversas que aumentem minha sensa√ß√£o de amea√ßa ou perigo.',
                styleHint: 'E'
            },
            {
                id: 'Q47',
                number: 47,
                schemaId: 'VV',
                text: '√Äs vezes pesquiso compulsivamente sobre doen√ßas, not√≠cias ou perigos para sentir que estou no controle.',
                styleHint: 'H'
            },
            {
                id: 'Q48',
                number: 48,
                schemaId: 'VV',
                text: 'Costumo orientar ou criticar os outros por ach√°-los ‚Äúrelaxados‚Äù com riscos que levo muito a s√©rio.',
                styleHint: 'H'
            },

            // EMARANHAMENTO/SELF SUBDESENVOLVIDO (EM) ‚Äì 6
            {
                id: 'Q49',
                number: 49,
                schemaId: 'EM',
                text: 'Muitas vezes sinto que minha identidade se mistura demais com a de algu√©m importante para mim.',
                styleHint: 'R'
            },
            {
                id: 'Q50',
                number: 50,
                schemaId: 'EM',
                text: 'Tenho dificuldade em saber o que eu realmente quero, separado do que os outros esperam.',
                styleHint: 'R'
            },
            {
                id: 'Q51',
                number: 51,
                schemaId: 'EM',
                text: 'Evito tomar decis√µes que possam desagradar pessoas pr√≥ximas, mesmo que isso me fa√ßa mal.',
                styleHint: 'E'
            },
            {
                id: 'Q52',
                number: 52,
                schemaId: 'EM',
                text: '√Äs vezes deixo meus planos de lado para n√£o criar dist√¢ncia ou conflito com algu√©m que amo.',
                styleHint: 'E'
            },
            {
                id: 'Q53',
                number: 53,
                schemaId: 'EM',
                text: 'Em alguns momentos tomo decis√µes bruscas de afastamento para provar que sou independente.',
                styleHint: 'H'
            },
            {
                id: 'Q54',
                number: 54,
                schemaId: 'EM',
                text: '√Äs vezes ajo de forma excessivamente aut√¥noma, recusando ajuda para n√£o parecer dependente.',
                styleHint: 'H'
            },

            // SUBJUGA√á√ÉO (SB) ‚Äì 6
            {
                id: 'Q55',
                number: 55,
                schemaId: 'SB',
                text: 'Frequentemente cedo √†s vontades dos outros com medo de que fiquem bravos ou me rejeitem.',
                styleHint: 'R'
            },
            {
                id: 'Q56',
                number: 56,
                schemaId: 'SB',
                text: 'Sinto que n√£o tenho tanto direito quanto os outros de dizer ‚Äún√£o‚Äù.',
                styleHint: 'R'
            },
            {
                id: 'Q57',
                number: 57,
                schemaId: 'SB',
                text: 'Evito expressar opini√µes diferentes para n√£o gerar conflito ou discuss√£o.',
                styleHint: 'E'
            },
            {
                id: 'Q58',
                number: 58,
                schemaId: 'SB',
                text: 'Costumo engolir minha raiva para manter a paz, mesmo quando me sinto injusti√ßado(a).',
                styleHint: 'E'
            },
            {
                id: 'Q59',
                number: 59,
                schemaId: 'SB',
                text: 'Em alguns momentos explodo de forma intensa depois de muito tempo calado(a).',
                styleHint: 'H'
            },
            {
                id: 'Q60',
                number: 60,
                schemaId: 'SB',
                text: '√Äs vezes assumo um tom autorit√°rio para compensar per√≠odos em que me senti muito submisso(a).',
                styleHint: 'H'
            },

            // AUTOSSACRIF√çCIO (SA) ‚Äì 6
            {
                id: 'Q61',
                number: 61,
                schemaId: 'SA',
                text: 'Com frequ√™ncia coloco as necessidades dos outros √† frente das minhas, mesmo ficando esgotado(a).',
                styleHint: 'R'
            },
            {
                id: 'Q62',
                number: 62,
                schemaId: 'SA',
                text: 'Sinto culpa quando penso em cuidar de mim mesmo(a) antes de ajudar algu√©m.',
                styleHint: 'R'
            },
            {
                id: 'Q63',
                number: 63,
                schemaId: 'SA',
                text: 'Evito pedir ajuda porque acredito que os outros precisam mais do que eu.',
                styleHint: 'E'
            },
            {
                id: 'Q64',
                number: 64,
                schemaId: 'SA',
                text: 'Costumo esconder meu cansa√ßo para n√£o desapontar quem conta comigo.',
                styleHint: 'E'
            },
            {
                id: 'Q65',
                number: 65,
                schemaId: 'SA',
                text: '√Äs vezes ajudo demais e depois fico ressentido(a), achando que ningu√©m faz por mim o mesmo esfor√ßo.',
                styleHint: 'H'
            },
            {
                id: 'Q66',
                number: 66,
                schemaId: 'SA',
                text: 'Em alguns momentos fa√ßo quest√£o de mostrar o quanto me sacrifico para que os outros reconhe√ßam meu valor.',
                styleHint: 'H'
            },

            // APROVA√á√ÉO/BUSCA POR RECONHECIMENTO (AP) ‚Äì 6
            {
                id: 'Q67',
                number: 67,
                schemaId: 'AP',
                text: 'Minha autoestima costuma depender muito do que os outros pensam de mim.',
                styleHint: 'R'
            },
            {
                id: 'Q68',
                number: 68,
                schemaId: 'AP',
                text: 'Tenho grande necessidade de ser bem visto(a) para me sentir valioso(a).',
                styleHint: 'R'
            },
            {
                id: 'Q69',
                number: 69,
                schemaId: 'AP',
                text: 'Evito mostrar fraquezas ou erros para n√£o correr o risco de ser mal avaliado(a).',
                styleHint: 'E'
            },
            {
                id: 'Q70',
                number: 70,
                schemaId: 'AP',
                text: '√Äs vezes visto um ‚Äúpersonagem‚Äù diferente de quem realmente sou, para agradar cada grupo.',
                styleHint: 'E'
            },
            {
                id: 'Q71',
                number: 71,
                schemaId: 'AP',
                text: 'Em alguns momentos exagero em conquistas, apar√™ncia ou desempenho para ser admirado(a).',
                styleHint: 'H'
            },
            {
                id: 'Q72',
                number: 72,
                schemaId: 'AP',
                text: 'Costumo disputar espa√ßo ou reconhecimento quando sinto que n√£o estou recebendo aten√ß√£o suficiente.',
                styleHint: 'H'
            },

            // DIREITOS ELEVADOS/GRANDIOSIDADE (EC) ‚Äì 6
            {
                id: 'Q73',
                number: 73,
                schemaId: 'EC',
                text: 'Muitas vezes sinto que mere√ßo algumas exce√ß√µes √†s regras que valem para os outros.',
                styleHint: 'R'
            },
            {
                id: 'Q74',
                number: 74,
                schemaId: 'EC',
                text: 'Costumo achar que minhas necessidades deveriam ser atendidas antes das demais.',
                styleHint: 'R'
            },
            {
                id: 'Q75',
                number: 75,
                schemaId: 'EC',
                text: 'Evito tarefas que considero pequenas demais para mim, esperando que outra pessoa fa√ßa.',
                styleHint: 'E'
            },
            {
                id: 'Q76',
                number: 76,
                schemaId: 'EC',
                text: '√Äs vezes me afasto de ambientes em que n√£o sou tratado(a) com o destaque que considero merecer.',
                styleHint: 'E'
            },
            {
                id: 'Q77',
                number: 77,
                schemaId: 'EC',
                text: 'Em certos momentos ultrapasso limites ou imponho minhas vontades, como se soubesse o que √© melhor para todos.',
                styleHint: 'H'
            },
            {
                id: 'Q78',
                number: 78,
                schemaId: 'EC',
                text: 'Costumo tratar os outros como se eles devessem se adaptar ao meu ritmo ou prefer√™ncias.',
                styleHint: 'H'
            },

            // AUTOCONTROLE/AUTODISCIPLINA INSUFICIENTES (AI) ‚Äì 6
            {
                id: 'Q79',
                number: 79,
                schemaId: 'AI',
                text: 'Tenho dificuldade em manter disciplina em tarefas que exigem esfor√ßo cont√≠nuo.',
                styleHint: 'R'
            },
            {
                id: 'Q80',
                number: 80,
                schemaId: 'AI',
                text: 'Com frequ√™ncia busco gratifica√ß√£o imediata, mesmo sabendo que isso pode me prejudicar depois.',
                styleHint: 'R'
            },
            {
                id: 'Q81',
                number: 81,
                schemaId: 'AI',
                text: 'Evito atividades que exigem organiza√ß√£o e planejamento porque me sobrecarregam rapidamente.',
                styleHint: 'E'
            },
            {
                id: 'Q82',
                number: 82,
                schemaId: 'AI',
                text: 'Frequentemente abandono projetos quando exigem muita const√¢ncia, preferindo algo mais prazeroso no momento.',
                styleHint: 'E'
            },
            {
                id: 'Q83',
                number: 83,
                schemaId: 'AI',
                text: 'Em alguns per√≠odos entro em fases de produtividade intensa para compensar momentos de descontrole.',
                styleHint: 'H'
            },
            {
                id: 'Q84',
                number: 84,
                schemaId: 'AI',
                text: '√Äs vezes imponho regras muito r√≠gidas para mim ou para outras pessoas depois de perceber que exagerei em impulsos.',
                styleHint: 'H'
            },

            // NEGATIVIDADE/PESSIMISMO (NP) ‚Äì 6
            {
                id: 'Q85',
                number: 85,
                schemaId: 'NP',
                text: 'Costumo imaginar primeiro o que pode dar errado antes de enxergar o que pode dar certo.',
                styleHint: 'R'
            },
            {
                id: 'Q86',
                number: 86,
                schemaId: 'NP',
                text: 'Mesmo quando as coisas est√£o indo bem, frequentemente espero que algo ruim aconte√ßa.',
                styleHint: 'R'
            },
            {
                id: 'Q87',
                number: 87,
                schemaId: 'NP',
                text: 'Evito me envolver em projetos que envolvam algum risco por medo de frustra√ß√µes.',
                styleHint: 'E'
            },
            {
                id: 'Q88',
                number: 88,
                schemaId: 'NP',
                text: '√Äs vezes deixo de aproveitar boas oportunidades por focar apenas nos poss√≠veis problemas.',
                styleHint: 'E'
            },
            {
                id: 'Q89',
                number: 89,
                schemaId: 'NP',
                text: 'Em alguns momentos aponto defeitos ou riscos em quase tudo, como forma de ‚Äúme proteger‚Äù de decep√ß√µes.',
                styleHint: 'H'
            },
            {
                id: 'Q90',
                number: 90,
                schemaId: 'NP',
                text: 'Costumo ser visto(a) como algu√©m muito preocupado(a) ou ‚Äúrealista demais‚Äù sobre o que pode dar errado.',
                styleHint: 'H'
            },

            // INIBI√á√ÉO EMOCIONAL (IE) ‚Äì 6
            {
                id: 'Q91',
                number: 91,
                schemaId: 'IE',
                text: 'Tenho dificuldade em expressar emo√ß√µes com naturalidade, mesmo perto de pessoas de confian√ßa.',
                styleHint: 'R'
            },
            {
                id: 'Q92',
                number: 92,
                schemaId: 'IE',
                text: 'Costumo segurar o choro, a raiva ou a alegria para n√£o parecer exagerado(a).',
                styleHint: 'R'
            },
            {
                id: 'Q93',
                number: 93,
                schemaId: 'IE',
                text: 'Evito falar sobre sentimentos em conversas importantes, preferindo ficar no lado racional.',
                styleHint: 'E'
            },
            {
                id: 'Q94',
                number: 94,
                schemaId: 'IE',
                text: '√Äs vezes mudo de assunto quando algu√©m tenta aprofundar uma conversa emocional comigo.',
                styleHint: 'E'
            },
            {
                id: 'Q95',
                number: 95,
                schemaId: 'IE',
                text: 'Em alguns momentos uso humor, ironias ou piadas em excesso para n√£o mostrar o que realmente estou sentindo.',
                styleHint: 'H'
            },
            {
                id: 'Q96',
                number: 96,
                schemaId: 'IE',
                text: '√Äs vezes pare√ßo frio(a) ou distante por fora, mesmo sentindo muitas coisas por dentro.',
                styleHint: 'H'
            },

            // PADR√ïES INFLEX√çVEIS/CR√çTICA EXAGERADA (PC) ‚Äì 6
            {
                id: 'Q97',
                number: 97,
                schemaId: 'PC',
                text: 'Costumo me cobrar demais para fazer tudo com perfei√ß√£o.',
                styleHint: 'R'
            },
            {
                id: 'Q98',
                number: 98,
                schemaId: 'PC',
                text: '√â dif√≠cil relaxar quando sinto que ainda h√° algo a ser melhorado ou organizado.',
                styleHint: 'R'
            },
            {
                id: 'Q99',
                number: 99,
                schemaId: 'PC',
                text: 'Evito iniciar alguns projetos porque temo n√£o conseguir faz√™-los no n√≠vel que considero ideal.',
                styleHint: 'E'
            },
            {
                id: 'Q100',
                number: 100,
                schemaId: 'PC',
                text: 'Demoro demais para concluir tarefas por ficar revisando detalhes e corre√ß√µes.',
                styleHint: 'E'
            },
            {
                id: 'Q101',
                number: 101,
                schemaId: 'PC',
                text: 'Em alguns momentos sou excessivamente cr√≠tico(a) comigo ou com os outros quando percebo erros.',
                styleHint: 'H'
            },
            {
                id: 'Q102',
                number: 102,
                schemaId: 'PC',
                text: '√Äs vezes imponho padr√µes muito r√≠gidos √†s pessoas ao meu redor, esperando que fa√ßam tudo ‚Äúdo jeito certo‚Äù.',
                styleHint: 'H'
            },

            // PUNITIVIDADE (PCO) ‚Äì 6
            {
                id: 'Q103',
                number: 103,
                schemaId: 'PCO',
                text: 'Tenho pouca toler√¢ncia com falhas, tanto minhas quanto das outras pessoas.',
                styleHint: 'R'
            },
            {
                id: 'Q104',
                number: 104,
                schemaId: 'PCO',
                text: 'Quando erro, sinto que mere√ßo cr√≠ticas duras ou algum tipo de puni√ß√£o.',
                styleHint: 'R'
            },
            {
                id: 'Q105',
                number: 105,
                schemaId: 'PCO',
                text: 'Evito falar sobre meus erros ou fragilidades para n√£o ter que lidar com cr√≠ticas (inclusive as minhas).',
                styleHint: 'E'
            },
            {
                id: 'Q106',
                number: 106,
                schemaId: 'PCO',
                text: 'Fujo de situa√ß√µes em que posso errar para n√£o me sentir ‚Äúfracassado(a)‚Äù ou ‚Äúerrado(a)‚Äù.',
                styleHint: 'E'
            },
            {
                id: 'Q107',
                number: 107,
                schemaId: 'PCO',
                text: '√Äs vezes sou duro(a) ao julgar quem erra, como se apenas puni√ß√£o fizesse algu√©m aprender.',
                styleHint: 'H'
            },
            {
                id: 'Q108',
                number: 108,
                schemaId: 'PCO',
                text: 'Em alguns momentos me pego usando frases cru√©is comigo mesmo(a) quando falho, sem permitir compaix√£o.',
                styleHint: 'H'
            }
        ];

        // Agrupamento em blocos (10 itens por bloco, √∫ltimo com 8)
        questions.forEach(q => {
            if (!q.group) {
                q.group = Math.ceil(q.number / 10); // 1 a 11
            }
        });

        const LIKERT_MIN = 1;
        const LIKERT_MAX = 6;

        const totalQuestions = questions.length;
        const groups = Array.from(
            new Set(
                questions.map(q => q.group || 1)
            )
        ).sort((a, b) => a - b);

        const totalBlocks = groups.length || 1;

        const questionsContainer = document.getElementById('questionsContainer');
        const progressInner = document.getElementById('progressInner');
        const progressText = document.getElementById('progressText');
        const blockTag = document.getElementById('blockTag');
        const prevBlockBtn = document.getElementById('prevBlock');
        const nextBlockBtn = document.getElementById('nextBlock');
        const reviewSummary = document.getElementById('reviewSummary');
        const missingList = document.getElementById('missingList');
        const calculateResultsBtn = document.getElementById('calculateResults');
        const resultsIntro = document.getElementById('resultsIntro');
        const resultsTableWrapper = document.getElementById('resultsTableWrapper');
        const sendWhatsAppBtn = document.getElementById('sendWhatsApp');
        const sharePageWhatsAppBtn = document.getElementById('sharePageWhatsApp');
        const perSchemaPsychoDiv = document.getElementById('perSchemaPsycho');

        let currentBlockIndex = 0;
        let responses = {};

        function getBlockQuestions(blockIndex) {
            const groupId = groups[blockIndex] ?? groups[0] ?? 1;
            return questions.filter(q => (q.group || 1) === groupId);
        }

        function updateProgressText(answeredCount, startItem, endItem) {
            const progressPercent = totalQuestions ?
                Math.round((answeredCount / totalQuestions) * 100) :
                0;

            progressInner.style.width = progressPercent + '%';
            progressText.textContent =
                `Itens respondidos: ${answeredCount} de ${totalQuestions} (${progressPercent}%)` +
                (startItem && endItem ? ` | Itens ${startItem} a ${endItem}` : '');
        }

        function renderCurrentBlock() {
            questionsContainer.innerHTML = '';

            const blockQuestions = getBlockQuestions(currentBlockIndex);
            const numbers = blockQuestions.map(q => q.number);
            const start = numbers.length ? Math.min(...numbers) : 0;
            const end = numbers.length ? Math.max(...numbers) : 0;

            blockTag.textContent = `Bloco ${currentBlockIndex + 1} de ${totalBlocks}`;

            const answeredCount = Object.keys(responses).length;
            updateProgressText(answeredCount, start, end);

            blockQuestions.forEach(q => {
                const block = document.createElement('div');
                block.className = 'question-block';

                const header = document.createElement('div');
                header.className = 'question-header';

                const textDiv = document.createElement('div');
                textDiv.className = 'question-text';
                textDiv.textContent = `${q.number}. ${q.text}`;

                header.appendChild(textDiv);
                block.appendChild(header);

                const likertRow = document.createElement('div');
                likertRow.className = 'likert-row';

                for (let v = LIKERT_MIN; v <= LIKERT_MAX; v++) {
                    const opt = document.createElement('label');
                    opt.className = 'likert-option';

                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = q.id;
                    input.value = v;
                    if (responses[q.id] === v) {
                        input.checked = true;
                    }

                    input.addEventListener('change', () => {
                        responses[q.id] = v;
                        const answered = Object.keys(responses).length;
                        updateProgressText(answered, start, end);
                        block.classList.remove('missing');
                        const err = block.querySelector('.error-msg');
                        if (err) err.remove();
                    });

                    const span = document.createElement('span');
                    span.textContent = v;

                    opt.appendChild(input);
                    opt.appendChild(span);
                    likertRow.appendChild(opt);
                }

                block.appendChild(likertRow);
                questionsContainer.appendChild(block);
            });

            if (prevBlockBtn) {
                prevBlockBtn.disabled = currentBlockIndex === 0;
            }

            if (nextBlockBtn) {
                nextBlockBtn.textContent =
                    currentBlockIndex === totalBlocks - 1 ?
                    'Ir para revis√£o' :
                    'Pr√≥ximo bloco';
            }

            scrollToQuestionnaire();
        }

        function validateCurrentBlock() {
            const blockQuestions = getBlockQuestions(currentBlockIndex);
            const blocks = questionsContainer.querySelectorAll('.question-block');
            let firstInvalid = null;

            blockQuestions.forEach((q, idx) => {
                const blockEl = blocks[idx];
                const hasResponse = responses[q.id] != null;
                if (!hasResponse) {
                    blockEl.classList.add('missing');
                    let err = blockEl.querySelector('.error-msg');
                    if (!err) {
                        err = document.createElement('div');
                        err.className = 'error-msg';
                        err.textContent = 'Responda este item antes de continuar.';
                        blockEl.appendChild(err);
                    }
                    if (!firstInvalid) firstInvalid = blockEl;
                } else {
                    blockEl.classList.remove('missing');
                    const err = blockEl.querySelector('.error-msg');
                    if (err) err.remove();
                }
            });

            if (firstInvalid) {
                firstInvalid.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
                return false;
            }
            return true;
        }

        if (goQuestionnaire) {
            goQuestionnaire.addEventListener('click', () => {
                userdataSection.classList.add('hidden');
                questionnaireSection.classList.remove('hidden');
                if (totalQuestions > 0) {
                    renderCurrentBlock();
                } else {
                    scrollToQuestionnaire();
                }
            });
        }

        if (prevBlockBtn) {
            prevBlockBtn.addEventListener('click', () => {
                if (currentBlockIndex > 0) {
                    currentBlockIndex--;
                    renderCurrentBlock();
                }
            });
        }

        if (nextBlockBtn) {
            nextBlockBtn.addEventListener('click', () => {
                if (!validateCurrentBlock()) return;

                if (currentBlockIndex < totalBlocks - 1) {
                    currentBlockIndex++;
                    renderCurrentBlock();
                } else {
                    questionnaireSection.classList.add('hidden');
                    reviewSection.classList.remove('hidden');
                    updateReviewSummary();
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                }
            });
        }

        function updateReviewSummary() {
            const answered = Object.keys(responses).length;
            const missing = totalQuestions - answered;
            reviewSummary.textContent = `Voc√™ respondeu ${answered} de ${totalQuestions} itens.`;

            if (missing > 0) {
                const missingNumbers = questions
                    .filter(q => !responses[q.id])
                    .map(q => q.number)
                    .sort((a, b) => a - b);
                missingList.innerHTML =
                    `<strong>Itens n√£o respondidos:</strong> ${missingNumbers.join(', ')}. ` +
                    `Se poss√≠vel, volte e complete todos para uma leitura mais precisa.`;
            } else {
                missingList.textContent =
                    'Todos os itens est√£o respondidos. Voc√™ pode gerar seus resultados com seguran√ßa.';
            }
        }

        if (calculateResultsBtn) {
            calculateResultsBtn.addEventListener('click', () => {
                const missing = questions.filter(q => !responses[q.id]);
                if (missing.length > 0) {
                    alert('Ainda h√° itens sem resposta. Idealmente, complete todos antes de gerar os resultados.');
                }
                reviewSection.classList.add('hidden');
                resultsSection.classList.remove('hidden');
                actionsSection.classList.remove('hidden');

                const resultObj = calculateSchemaScores();
                renderResults(resultObj);
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }

        // =========================
        // C√ÅLCULO DE ESCORES E ESTILOS
        // =========================
        function calculateSchemaScores() {
            const schemaScores = {};
            schemas.forEach(s => {
                schemaScores[s.id] = {
                    schema: s,
                    sum: 0,
                    count: 0,
                    mean: 0,
                    status: 'ausente',
                    styleScores: {
                        resignado: 0,
                        evitativo: 0,
                        hipercompensador: 0
                    },
                    styleLabel: 'N√£o definido',
                    interpretacao: ''
                };
            });

            questions.forEach(q => {
                const val = responses[q.id];
                if (val != null && schemaScores[q.schemaId]) {
                    const entry = schemaScores[q.schemaId];
                    entry.sum += val;
                    entry.count += 1;

                    if (q.styleHint === 'R') entry.styleScores.resignado += val;
                    if (q.styleHint === 'E') entry.styleScores.evitativo += val;
                    if (q.styleHint === 'H') entry.styleScores.hipercompensador += val;
                }
            });

            Object.keys(schemaScores).forEach(schemaId => {
                const entry = schemaScores[schemaId];

                entry.mean = entry.count > 0 ? entry.sum / entry.count : 0;

                if (entry.mean >= 4.0) {
                    entry.status = 'ativo';
                } else if (entry.mean >= 2.5) {
                    entry.status = 'latente';
                } else {
                    entry.status = 'ausente';
                }

                const ss = entry.styleScores;
                const order = ['resignado', 'evitativo', 'hipercompensador'];
                let topKey = order[0];
                let topVal = ss[topKey];

                order.forEach(key => {
                    if (ss[key] > topVal) {
                        topKey = key;
                        topVal = ss[key];
                    }
                });

                if (topVal === 0) {
                    entry.styleLabel = 'N√£o definido';
                } else {
                    if (topKey === 'resignado') entry.styleLabel = 'Resignado(a)';
                    if (topKey === 'evitativo') entry.styleLabel = 'Evitativo(a)';
                    if (topKey === 'hipercompensador') entry.styleLabel = 'Hipercompensador(a)';
                }

                if (entry.status === 'ativo') {
                    entry.interpretacao =
                        `H√° ind√≠cios de que o esquema de ${entry.schema.nome} esteja impactando sua vida atual de forma significativa. ` +
                        `O estilo de enfrentamento predominante estimado √©: ${entry.styleLabel}.`;
                } else if (entry.status === 'latente') {
                    entry.interpretacao =
                        `O esquema de ${entry.schema.nome} aparece como uma vulnerabilidade em segundo plano, ` +
                        `que tende a ser ativada em contextos espec√≠ficos. Estilo de enfrentamento predominante: ${entry.styleLabel}.`;
                } else {
                    entry.interpretacao =
                        `Neste momento, o esquema de ${entry.schema.nome} n√£o parece contribuir de forma relevante para o sofrimento atual.`;
                }
            });

            return schemaScores;
        }

        // =========================
        // GR√ÅFICO ‚Äì CORES POR STATUS
        // =========================
        function getChartColors() {
            const isDark = document.body.classList.contains('theme-dark');
            return {
                tick: isDark ? '#f5f5f7' : '#222222',
                grid: isDark ? 'rgba(255,255,255,0.12)' : 'rgba(0,0,0,0.08)'
            };
        }

        function applyChartTheme(chart) {
            const c = getChartColors();
            if (chart.options.scales && chart.options.scales.x && chart.options.scales.y) {
                chart.options.scales.x.ticks.color = c.tick;
                chart.options.scales.y.ticks.color = c.tick;
                chart.options.scales.x.grid.color = c.grid;
                chart.options.scales.y.grid.color = c.grid;
            }
            if (chart.options.plugins && chart.options.plugins.legend) {
                chart.options.plugins.legend.labels.color = c.tick;
            }
        }

        window.schemasChartInstance = null;

        function renderResults(schemaScores) {
            const nome = nomeInput?.value?.trim() || 'Paciente';
            resultsIntro.textContent =
                `${nome}, abaixo voc√™ encontra um panorama dos esquemas avaliados. ` +
                `Use estas informa√ß√µes como ponto de partida para conversar com seu psic√≥logo(a) sobre o que mais faz sentido para a sua hist√≥ria.`;

            let html = `
        <table>
          <thead>
            <tr>
              <th>Esquema</th>
              <th>Dom√≠nio</th>
              <th>Escore m√©dio</th>
              <th>Status</th>
              <th>Estilo de enfrentamento predominante</th>
            </tr>
          </thead>
          <tbody>
      `;

            Object.keys(schemaScores).forEach(schemaId => {
                const entry = schemaScores[schemaId];
                const mean = entry.count > 0 ? entry.mean.toFixed(2) : '-';
                let statusClass = 'status-ausente';
                let statusLabel = 'Ausente';

                if (entry.status === 'ativo') {
                    statusClass = 'status-ativo';
                    statusLabel = 'Ativo';
                } else if (entry.status === 'latente') {
                    statusClass = 'status-latente';
                    statusLabel = 'Latente';
                }

                html += `
          <tr>
            <td>${entry.schema.nome}</td>
            <td>${entry.schema.dominio}</td>
            <td>${mean}</td>
            <td><span class="status-chip ${statusClass}">${statusLabel}</span></td>
            <td>${entry.styleLabel}</td>
          </tr>
        `;
            });

            html += `</tbody></table>`;
            resultsTableWrapper.innerHTML = html;

            const labels = [];
            const dataMeans = [];
            const bgColors = [];
            const borderColors = [];

            Object.keys(schemaScores).forEach(schemaId => {
                const entry = schemaScores[schemaId];
                labels.push(entry.schema.nome);
                dataMeans.push(entry.mean);

                if (entry.status === 'ativo') {
                    bgColors.push('rgba(220,38,38,0.85)'); // vermelho
                    borderColors.push('rgba(185,28,28,1)');
                } else if (entry.status === 'latente') {
                    bgColors.push('rgba(234,179,8,0.85)'); // amarelo
                    borderColors.push('rgba(202,138,4,1)');
                } else {
                    bgColors.push('rgba(22,163,74,0.85)'); // verde
                    borderColors.push('rgba(21,128,61,1)');
                }
            });

            const ctx = document.getElementById('schemasChart').getContext('2d');
            if (window.schemasChartInstance) {
                window.schemasChartInstance.destroy();
            }

            const colors = getChartColors();

            window.schemasChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: 'M√©dia de resposta (1 a 6)',
                        data: dataMeans,
                        borderWidth: 1,
                        backgroundColor: bgColors,
                        borderColor: borderColors,
                        maxBarThickness: 26
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 6,
                            ticks: {
                                color: colors.tick
                            },
                            grid: {
                                color: colors.grid
                            }
                        },
                        y: {
                            ticks: {
                                color: colors.tick
                            },
                            grid: {
                                color: colors.grid
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: colors.tick
                            }
                        }
                    }
                }
            });

            applyChartTheme(window.schemasChartInstance);
            window._mapaEsquemasResults = schemaScores;

            // Psicoeduca√ß√£o por esquema ativo (HTML)
            if (perSchemaPsychoDiv) {
                const ativos = Object.values(schemaScores).filter(e => e.status === 'ativo');
                if (ativos.length === 0) {
                    perSchemaPsychoDiv.innerHTML =
                        '<p class="muted">Nenhum esquema apareceu claramente ativo. Ainda assim, os esquemas latentes e o padr√£o geral de respostas podem ser √∫teis para reflex√£o em psicoterapia.</p>';
                } else {
                    let peHtml = '';
                    ativos.forEach(entry => {
                        const info = schemaPsycho[entry.schema.id];
                        if (!info) return;
                        peHtml += `
              <div class="schema-card">
                <p><strong>${info.titulo}</strong></p>
                <p>${info.definicao}</p>
                <p>${info.origem}</p>
                <p><strong>Quando voc√™ reage de forma resignada:</strong> ${info.resignado}</p>
                <p><strong>Quando reage de forma evitativa:</strong> ${info.evitativo}</p>
                <p><strong>Quando reage de forma hipercompensadora:</strong> ${info.hipercompensador}</p>
              </div>
            `;
                    });
                    perSchemaPsychoDiv.innerHTML = peHtml;
                }
            }
        }

        // =========================
        // WHATSAPP ‚Äì RESUMO
        // =========================
        function buildWhatsAppMessage() {
            const results = window._mapaEsquemasResults || null;
            if (!results || !Object.keys(results).length) {
                return null;
            }

            const nome = nomeInput?.value?.trim() || 'Paciente';
            const idade = idadeInput?.value?.trim();
            const dataAp = dataInput?.value?.trim();

            const headerLines = [];
            headerLines.push(`*Mapa de Esquemas ‚Äì Invent√°rio de Padr√µes Emocionais*`);
            headerLines.push(`Nome: ${nome}`);
            if (idade) headerLines.push(`Idade: ${idade} anos`);
            if (dataAp) headerLines.push(`Data de aplica√ß√£o: ${dataAp}`);
            headerLines.push('');

            const ativos = [];
            const latentes = [];

            Object.values(results).forEach(entry => {
                const mean = entry.count > 0 ? entry.mean.toFixed(2) : '-';
                const baseLine = `${entry.schema.nome} (m√©dia: ${mean}) ‚Äì Estilo: ${entry.styleLabel}`;
                if (entry.status === 'ativo') {
                    ativos.push(`‚Ä¢ ${baseLine}`);
                } else if (entry.status === 'latente') {
                    latentes.push(`‚Ä¢ ${baseLine}`);
                }
            });

            const bodyLines = [];

            if (ativos.length > 0) {
                bodyLines.push(`*Esquemas ativos (maior relev√¢ncia cl√≠nica):*`);
                bodyLines.push(...ativos);
                bodyLines.push('');
            } else {
                bodyLines.push(`Nenhum esquema apareceu claramente *ativo* neste momento.`);
                bodyLines.push('');
            }

            if (latentes.length > 0) {
                bodyLines.push(`*Esquemas latentes (vulnerabilidades em segundo plano):*`);
                bodyLines.push(...latentes);
                bodyLines.push('');
            }

            bodyLines.push(`Observa√ß√£o: este resultado √© um rastreio psicoeducativo e deve ser integrado √† avalia√ß√£o cl√≠nica e √† sua hist√≥ria em psicoterapia.`);

            return headerLines.concat('', bodyLines).join('\n');
        }

        if (sendWhatsAppBtn) {
            sendWhatsAppBtn.addEventListener('click', () => {
                const msg = buildWhatsAppMessage();
                if (!msg) {
                    alert('Gere os resultados antes de enviar o resumo pelo WhatsApp.');
                    return;
                }
                const encoded = encodeURIComponent(msg);

                // DDI 55 (Brasil) + DDD 35 + n√∫mero
                const phone = '5535984640729';
                const url = `https://wa.me/${phone}?text=${encoded}`;

                window.open(url, '_blank');
            });
        }

        if (sharePageWhatsAppBtn) {
            sharePageWhatsAppBtn.addEventListener('click', () => {
                const pageUrl = window.location.href || 'https://https://ricmurtapsicologia.github.io/rastreio.de.esquemas/';
                const message = `Quero compartilhar com voc√™ esta ferramenta de autoconhecimento baseada em Terapia do Esquema: Mapa de Esquemas ‚Äì Invent√°rio de Padr√µes Emocionais. Acesse: ${pageUrl}`;
                const encoded = encodeURIComponent(message);
                const url = `https://wa.me/?text=${encoded}`;
                window.open(url, '_blank');
            });
        }
    </script>
</body>

</html>
